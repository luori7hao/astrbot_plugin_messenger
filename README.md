# 通风报信插件 (astrbot_plugin_messenger)

一个有趣的 AstrBot 插件，帮你传话给好友，支持来回对话！

## 功能特点

- 📨 **传话功能**：向机器人发送消息，让它帮你传话给好友
- 🔄 **回复链**：支持双方通过引用消息来回对话
- 📢 **通告群聊**：管理员向指定群聊发送通告，群成员回复会私聊转发给你
- 🤖 **智能识别**：支持 LLM 智能识别，即使消息格式不完全匹配也能理解意图
- ⚙️ **可配置**：支持自定义消息前缀和提示符号
- 📡 **一键群发**：管理员可向所有好友和群聊发送消息（支持图片和回复！）

## 命令一览

| 命令 | 说明 | 权限 |
|------|------|------|
| `传话帮助` | 查看插件帮助信息 | 所有人 |
| `传话 @某人 消息` | 帮你传话给好友 | 所有人 |
| `转发 @某人 消息` | 同上（别名） | 所有人 |
| `转告 @某人 消息` | 同上（别名） | 所有人 |
| `通告群聊 群号 消息` | 向指定群发送通告 | 管理员 |
| `群发 消息` | 向所有好友和群发送消息 | 管理员 |
| 引用传话消息 + 回复内容 | 回复传话/通告/群发 | 所有人 |

> 💡 发送 `传话帮助` 或 `/传话帮助` 即可在聊天中查看所有命令说明。

## 使用方法

### 1. 发起传话

向机器人发送以下格式的消息：

```
传话 @某人 消息内容
```

支持的格式变体：
- `传话 QQ号 消息内容`
- `转发 @某人 消息内容`
- `转告 @某人 消息内容`

如果启用了 LLM 智能识别，你甚至可以说：
- "帮我告诉张三今晚一起吃饭"
- "跟 123456789 说一声我到了"

### 2. 回复传话

当收到传话消息后，**引用**该消息并直接发送回复内容即可：

```
[引用消息] 好的，我知道了
```

### 3. 通告群聊（管理员功能）

向指定群发送通告：

```
通告群聊 群号 消息内容
```

- 仅管理员可用（需在配置中设置 `admin_qq_list`）
- 消息会发送到指定群
- 群内成员**引用**该消息进行回复时，Bot 会将回复内容**私聊转发给你**
- 你可以继续引用回复，形成跨群对话

### 4. 一键群发（管理员功能）

向所有好友和群聊发送消息：

```
/群发 消息内容
```

- **支持图片**：消息中可以包含图片
- **支持回复**：收到群发消息的好友或群成员，**引用**该消息回复，内容会转发给管理员
- 仅管理员可用（需在配置中设置 `admin_qq_list`）
- 会自动排除黑名单中的 QQ 和群
- 支持设置发送间隔，防止风控

## 配置选项

在 AstrBot 管理面板中可以配置以下选项：

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| enable_llm_recognition | 启用 LLM 智能识别 | true |
| message_prefix | 传话消息前缀 | 📨 |
| success_prefix | 成功提示前缀 | ✅ |
| error_prefix | 错误提示前缀 | ❌ |
| admin_qq_list | 管理员QQ列表（逗号分隔） | "" |

### 收件箱设置

为了避免私聊被频繁打断，你可以设置一个"收件箱"来统一接收发给你的消息：

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| inbox_settings.enable_inbox | 启用收件箱功能 | false |
| inbox_settings.owner_qq | 使用者QQ号（绑定你的QQ） | "" |
| inbox_settings.inbox_type | 收件箱类型 (group/private) | group |
| inbox_settings.inbox_id | 收件箱ID（群号或QQ号） | "" |

**工作原理**：
1. 设置 `owner_qq` 为你的QQ号
2. 创建一个只有你和机器人的群，将群号填入 `inbox_id`
3. 所有原本要发给你私聊的消息（传话回复、群发消息等）都会转移到收件箱

### 群发设置

一键群发功能配置：

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| broadcast_settings.blacklist | 黑名单列表（QQ号和群号），用逗号分隔 | "" |
| broadcast_settings.delay_seconds | 每条消息发送间隔（秒） | 1 |

## 示例流程

**传话流程**：
```
A: 传话 @B 今晚有空吗？
Bot: ✅ 已将消息传达给 B！

[B 收到私聊]
Bot: 📨 A 对你说：今晚有空吗？

[B 引用消息回复]
B: 有啊，什么事？
Bot: ✅ 已将你的回复转达给 A！

[A 收到私聊]
Bot: 📨 B 让我回复你：有啊，什么事？
```

**通告群聊流程**：
```
A: 通告群聊 123456 周末聚餐报名开始！
Bot: ✅ 已将通告发送到群「xx群」！

[群 123456]
Bot: 📨 A 通告：周末聚餐报名开始！

[群成员 C 引用回复]
C: 我报名！
Bot: ✅ 已将你的回复转达给 A！

[A 收到私聊]
Bot: 📨 C 让我回复你：我报名！
```

## 安装方法

1. 下载 `astrbot_plugin_messenger.zip`
2. 在 AstrBot 管理面板中上传并安装插件
3. 或者解压到 `data/plugins/astrbot_plugin_messenger` 目录
4. 重启 AstrBot

## 许可证

MIT License
